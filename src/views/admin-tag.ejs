<main class="admin-wrap-main">
    <div class="responsive-wrapper">
        <div class="admin-1-header">
            <h1>Tags Page</h1>
        </div>
        <p class="mb-4">
            이 페이지는 태그 관리하는 페이지이므로 부절한 단어 또는 위험적인 단어는 선택적으로
            삭제해주세요.
        </p>
        <div class="horizontal-tabs">
            <a href="/admin-user">User</a>
            <a href="/admin-party">Party</a>
            <a href="/admin-review">Review</a>
            <a href="/admin-tag">Tags</a>
        </div>
    </div>
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Tags DataTables</h6>
            <body>
                <section>
                    <input id="searchInput" type="text" placeholder="이름으로 검색" />
                    <button id="searchButton" type="button">검색</button>
                </section>
            </body>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable">
                    <thead>
                        <tr>
                            <th>Number</th>
                            <th>Tag</th>
                            <th>Frequency</th>
                            <th>Create Date</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>Number</th>
                            <th>Tag</th>
                            <th>Frequency</th>
                            <th>Create Date</th>
                            <th>Delete</th>
                        </tr>
                    </tfoot>
                    <tbody id="tagTables"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        let tagList
        $(document).ready(() => {
            $.ajax({
                type: 'GET',
                url: `/admin/tags`,
                data: {},
                headers: {
                    authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                    refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
                },
                success: function (response) {
                    tagList = response
                    for (let i = 0; i < response.length; i++) {
                        const { tagId, id, tagName, freq, createdAt } = response[i];
                        let tagid = i + 1;
                        let Id = response[i].id;
                        let tagNames = response[i].tagName;
                        let Freq = response[i].freq;
                        let createDate = new Date(response[i].createdAt);

                        const year = createDate.getFullYear();
                        const month = ('0' + (createDate.getMonth() + 1)).slice(-2);
                        const day = ('0' + createDate.getDate()).slice(-2);
                        const tagTable = `
                    <tr>
                            <td>${tagid}</td>
                            <td>${tagNames}</td>
                            <td>${Freq}</td>
                            <td>${year}-${month}-${day}</td>
                            <td><button type="button" id = "deleteTag(${Id})" onclick="deleteTag(${Id})" class="btn btn-danger">Delete</button></td>s
                        </tr>
                    `;

                        $('#tagTables').append(tagTable);
                    }
                },
            });
        });

    $('#searchButton').on('click', function () {
    $('#tagTables').empty();
    const searchValue = $('#searchInput').val();
    tagList = tagList.filter((tag) => tag.tagName === searchValue)
    for (let i = 0; i < tagList.length; i++) {
                        const { tagId, id, tagName, freq, createdAt } = tagList[i];
                        let tagid = i + 1;
                        let Id = tagList[i].id;
                        let tagNames = tagList[i].tagName;
                        let Freq = tagList[i].freq;
                        let createDate = new Date(tagList[i].createdAt);

                        const year = createDate.getFullYear();
                        const month = ('0' + (createDate.getMonth() + 1)).slice(-2);
                        const day = ('0' + createDate.getDate()).slice(-2);
                        const tagTable = `
                    <tr>
                            <td>${tagid}</td>
                            <td>${tagNames}</td>
                            <td>${Freq}</td>
                            <td>${year}-${month}-${day}</td>
                            <td><button type="button" id = "deleteTag(${Id})" onclick="deleteTag(${Id})" class="btn btn-danger">Delete</button></td>s
                        </tr>
                    `;

                        $('#tagTables').append(tagTable);
                    }
        })

        function deleteTag(tagId) {
            const result = confirm('해당 태그를 삭제하시겠습니까?');
            if (result) {
                $.ajax({
                    type: 'DELETE',
                    url: `/admin/tag/${tagId}`,
                    data: {},
                    headers: {
                        authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                        refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
                    },
                    success: function (response) {
                        alert('태그 삭제 되었습니다.');
                        $(`#id${tagId}`).remove();
                        window.location.reload();
                    },
                });
            } else {
                alert('삭제 취소되었습니다.');
            }
        }
    </script>
</main>
