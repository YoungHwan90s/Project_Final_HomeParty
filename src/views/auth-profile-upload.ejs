<!-- <div class="create-item-value">
    <input type="file" id="item-image" accept="image/*" />
    <input type="hidden" id="item-image-url" />
</div>

<div class="item-create-btn-wrap">
    <button type="button" onclick="createItem()">등록</button>
</div>
 -->

<div class="container">
    <h1>
        이미지 업로드
        <small>미리보기</small>
    </h1>
    <div class="avatar-upload">
        <div class="avatar-edit">
            <input type="file" id="imageUpload" accept=".png, .jpg, .jpeg" />
            <input type="hidden" id="imageUrl" />
            <label for="imageUpload"></label>
        </div>
        <div class="avatar-preview">
            <div
                id="imagePreview"
                style="background-image: url(http://i.pravatar.cc/500?img=7)"
            ></div>
        </div>
    </div>
    <div class="btn_area">
        <button
            onclick="saveImage()"
            type="button"
            id="save-profile"
            class="btn_type btn_primary btn_point"
            style="margin-bottom: 10px"
        >
            저장하기
        </button>
        <button onclick="location.replace('/')" type="button" class="btn_type btn_primary">
            건너뛰기
        </button>
    </div>
</div>

<script>
    $('#imageUpload').change(function () {
        readURL(this);
    });

    function saveImage() {
        const image = $('#imageUpload').get(0);
        const file = image.files[0];
        
        if (!file) {
            customAlert('업로드된 이미지가 없습니다.', function () {
                    window.location.reload();
                });
        }
        const formData = new FormData();
        formData.append('file', file, encodeURIComponent(file.name));

        $.ajax({
            type: 'POST',
            url: '/file/upload',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $('#imageUrl').val(response.filePath.location);
                $('#imageUrl').trigger('change')
            },
            error: function (response) {
                customAlert(response.responseJSON.message, function () {
                    window.location.reload();
                });
            },
        });
    }

    $('#imageUrl').on('change', () => {
        const userInfo = {
            id: sessionStorage.getItem('userId'),
            profile: $('#imageUrl').val(),
        };

        $.ajax({
            type: 'PATCH',
            url: `/auth/profile-update`,
            data: userInfo,
            success: function (response) {
                sessionStorage.removeItem('userId');
                customAlert('이미지가 성공적으로 저장되었습니다.', function () {
                    window.location.replace('/');
                });
            },
            error: function (response) {
                customAlert(response.responseJSON.message, function () {
                    window.location.reload();
                });
            },
        });
    });
</script>
