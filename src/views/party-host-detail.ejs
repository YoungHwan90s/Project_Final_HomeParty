<h2>íŒŒí‹° ìƒì„¸í˜ì´ì§€ í˜¸ìŠ¤íŠ¸ í™”ë©´</h2>
<div class="party-host-detail-review"></div>
<div class="party-host-detail-review-title">
    <h2> ğŸ‘ë¦¬ë·°</h2>
</div>
<div id="reviews-container">
    <!-- ë¦¬ë·° ë°ì´í„°ê°€ ì¶œë ¥ë  ê³µê°„ -->
  </div>
<button onclick="readreview()">ë¦¬ë·°ë³´ê¸°</button>

<div class="party-host-detail-review-content">
  
    <div class="review-userId"></div>
    <div class="input-star">
        <span class="star">
          
            <span>â˜…â˜…â˜…â˜…â˜…</span>
            <input  type="range" oninput="drawStar(this)" value="5" step="1" min="0" max="10">
          </span>
    </div>
    <textarea id="input-review" class="input-review" placeholder="íŒŒí‹° ë¦¬ë·° í•´ì£¼ì„¸ìš”"></textarea>
    <button type="button" onclick="review()">ë¦¬ë·°ë“±ë¡</button>
</div>
<div id="map" style=" margin: auto; width:50%;height:450px;"></div>

<!-- ì¹´ì¹´ì˜¤ë§µ  -->
<script  type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=70d8ff63eb262881fd470f567a2259ab&libraries=services,clusterer"></script>
<script>
$(function() {
  // ë³„ì  í‘œì‹œ
  const drawStar = (target) => {
    $('.star span').css({ width: `${target.value * 10}%` });
  }})

    // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
    function review(){
      const partyId = window.location.pathname.split('/')[2] //ë³€ê²½í•´ì•¼ë¨
      const reviewInfo={
         review : $('#input-review').val(), //  ë¦¬ë·° ë‚´ìš©
         rating : $('.input-star input[type="range"]').val(), // ë³„ì 
        }
       
      $.ajax({
      type: 'POST',
      url: `/review/${partyId}`,
      data: reviewInfo,
      headers: {
                authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
            },
      success: function(response) {
        // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
        alert("ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.")
        location.reload();
      },
      error: function(error) {
        // ì„œë²„ë¡œë¶€í„° ì˜¤ë¥˜ ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
        alert("ì˜¬ë°”ë¥´ì§€ì•Šì€ ê°’ì…ë‹ˆë‹¤.")
      }
    });
  };
;

function readreview(){
  $.ajax({
    url: "/review/1", // ë¦¬ë·° ë°ì´í„° ìš”ì²­ URL
    type: "GET",
    dataType: "json",
    headers: {
                authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
            },
    success: function(data){
      $('#reviews-container').empty();

      data.map((reviewInfo)=>{
        const createdAt = new Date(reviewInfo.createdAt);
        let html = 
        ` <div class="party-host-detail-review-one">
                <div class="party-host-detail-review-content">
                  <text>ë¦¬ë·°</text>
                  <span id="review-content">${reviewInfo.review}</span>
                  <text>í‰ì </text>
                  <span id="review-star">${reviewInfo.rating}</span>
                  <text>ìœ ì €</text>
                  <span id="userId">${reviewInfo.userId}</span>
                  <span id="createdAt">${createdAt.getFullYear()}-${createdAt.getMonth() + 1}-${createdAt.getDate()}</span>
                  <input id="updatereviewform"></input>
                    <button type="button" onclick="updatereview(${reviewInfo.id})"id="review-update">ìˆ˜ì •í•˜ê¸°</button>
                    <button type="button" onclick="deletereview(${reviewInfo.id})"id="review-delete">ì‚­ì œí•˜ê¸°</button>
                    <div class="party-host-detail-review-userid"></div>
                </div>
        </div>
  </div>`
  $('#reviews-container').append(html)
      }
      )
}})
}


function updatereview(reviewId){
  const updatereviewform = $('#updatereviewform').val()
$.ajax({
          type: 'PATCH',
          url: `/review/${reviewId}`,
          data:{
            review: updatereviewform
          },
          headers: {
                authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
            },
          success: function(response) {
            // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
            alert("ë¦¬ë·°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
          },
          error: function(error) {
            // ì„œë²„ë¡œë¶€í„° ì˜¤ë¥˜ ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
            alert("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì…ë‹ˆë‹¤.");
          }
        });
        console.log(id);
      }
      

function deletereview(reviewId) {
  
  $.ajax({
    type: 'DELETE',
    url: `/review/${reviewId}`,
    headers: {
                authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
                refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
            },
    success: function(response) {
      alert("ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
      location.reload();
    },
    error: function(error) {
      alert("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì…ë‹ˆë‹¤.")
    }
  });
}

  
</script>


<!-- ì¹´ì¹´ì˜¤ë§µ -->
<script>
  var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
      mapOption = {
          center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 6 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
      };  
  
  // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
  var map = new kakao.maps.Map(mapContainer, mapOption); 
  // ë§ˆìš°ìŠ¤ íœ ê³¼ ëª¨ë°”ì¼ í„°ì¹˜ë¥¼ ì´ìš©í•œ ì§€ë„ í™•ëŒ€, ì¶•ì†Œë¥¼ ë§‰ëŠ”ë‹¤
    // map.setZoomable(false);   
  // ì£¼ì†Œ-ì¢Œí‘œ ë³€í™˜ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
  var geocoder = new kakao.maps.services.Geocoder();
    // ì§€ë„ íƒ€ì… ë³€ê²½ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•œë‹¤
    var mapTypeControl = new kakao.maps.MapTypeControl();
    // ì§€ë„ì˜ ìƒë‹¨ ìš°ì¸¡ì— ì§€ë„ íƒ€ì… ë³€ê²½ ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•œë‹¤
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);	
    // ì§€ë„ì— í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•œë‹¤
    var zoomControl = new kakao.maps.ZoomControl();
    // ì§€ë„ì˜ ìš°ì¸¡ì— í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•œë‹¤
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
      // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì£¼ì†Œ
    var markerImageUrl = 'https://cdn-icons-png.flaticon.com/512/9181/9181917.png', 
        markerImageSize = new kakao.maps.Size(51, 52), // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ í¬ê¸°
        markerImageOptions = { 
            offset : new kakao.maps.Point(25, 25)// ë§ˆì»¤ ì¢Œí‘œì— ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ì•ˆì˜ ì¢Œí‘œ
        };
      // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤
    var markerImage = new kakao.maps.MarkerImage(markerImageUrl, markerImageSize, markerImageOptions);
  // ì£¼ì†Œë¡œ ì¢Œí‘œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
  geocoder.addressSearch('ê±´ì›ëŒ€ë¡œ34ë²ˆê¸¸ 32-29', function(result, status) {
  // ë¬´ì¡°ê±´ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì‘ì„±í•´ì¤˜ì•¼ëœë‹¤
  
      // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´ 
       if (status === kakao.maps.services.Status.OK) {
  
          var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
          console.log(coords);
          // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
          var marker = new kakao.maps.Marker({
              map: map,
              image : markerImage, // ë§ˆì»¤ì˜ ì´ë¯¸ì§€
              position: coords
          });
  
          // ì¸í¬ìœˆë„ìš°ë¡œ ì¥ì†Œì— ëŒ€í•œ ì„¤ëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤
          var infowindow = new kakao.maps.InfoWindow({
              content: '<div style="background-color: white; color: black; padding: 8px; border-radius: 10px; width: auto; white-space: nowrap;">ì •í™•í•œ ìœ„ì¹˜ëŠ” ì‹ ì²­ì™„ë£Œ í›„ì— í‘œì‹œ ë©ë‹ˆë‹¤.</div>'
          });
          infowindow.open(map, marker);
  
          // ì§€ë„ì˜ ì¤‘ì‹¬ì„ ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤
          map.setCenter(coords);
      } 
      // ì§€ë„ì— ì›ì„ í‘œì‹œí•œë‹¤
    var circle = new kakao.maps.Circle({
      map: map, // ì›ì„ í‘œì‹œí•  ì§€ë„ ê°ì²´
      center : new kakao.maps.LatLng(result[0].y, result[0].x), // ì§€ë„ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
       radius: 500,  //ë¯¸í„° ë‹¨ìœ„ì˜ ì›ì˜ ë°˜ì§€ë¦„
        strokeWeight: 5,  // ì„ ì˜ ë‘ê»˜
        strokeColor: '#75B8FA',   //ì„ ì˜ ìƒ‰ê¹”
        strokeOpacity: 0,//ì„ ì˜ ë¶ˆíˆ¬ëª…ë„ 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ëª…í•´ì§
        fillColor: '#F7BCCC', //ì±„ìš°ê¸° ìƒ‰ê¹”
        fillOpacity: 0.5 // ì±„ìš°ê¸° ë¶ˆíˆ¬ëª…ë„ 
    });	
  });   
  </script>