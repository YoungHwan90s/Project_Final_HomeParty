<h2>íŒŒí‹° ìƒì„¸í˜ì´ì§€ í˜¸ìŠ¤íŠ¸ í™”ë©´</h2>
<div class="party-host-detail-review"></div>
<div class="party-host-detail-review-title">
    <h2> ğŸ‘ë¦¬ë·°</h2>
</div>
<div id="reviews-container">
    <!-- ë¦¬ë·° ë°ì´í„°ê°€ ì¶œë ¥ë  ê³µê°„ -->
  </div>
<button onclick="readreview()">ë¦¬ë·°ë³´ê¸°</button>

<div class="party-host-detail-review-content">
  
    <div class="review-userId"></div>
    <div class="input-star">
        <span class="star">
          
            <span>â˜…â˜…â˜…â˜…â˜…</span>
            <input  type="range" oninput="drawStar(this)" value="5" step="1" min="0" max="10">
          </span>
    </div>
    <textarea id="input-review" class="input-review" placeholder="íŒŒí‹° ë¦¬ë·° í•´ì£¼ì„¸ìš”"></textarea>
    <button type="button" onclick="review()">ë¦¬ë·°ë“±ë¡</button>
</div>
<script>
$(function() {
  // ë³„ì  í‘œì‹œ
  const drawStar = (target) => {
    $('.star span').css({ width: `${target.value * 10}%` });
  }})

    // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
    function review(){
      const partyId = window.location.pathname.split('/')[2] //ë³€ê²½í•´ì•¼ë¨
      const reviewInfo={
         review : $('#input-review').val(), //  ë¦¬ë·° ë‚´ìš©
         rating : $('.input-star input[type="range"]').val(), // ë³„ì 
        }
       
      $.ajax({
      type: 'POST',
      url: `/review/${partyId}`,
      data: reviewInfo,
      success: function(response) {
        // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
        alert("ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.")
        location.reload();
      },
      error: function(error) {
        // ì„œë²„ë¡œë¶€í„° ì˜¤ë¥˜ ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
        alert("ì˜¬ë°”ë¥´ì§€ì•Šì€ ê°’ì…ë‹ˆë‹¤.")
      }
    });
  };
;

function readreview(){
  $.ajax({
    url: "/review/1", // ë¦¬ë·° ë°ì´í„° ìš”ì²­ URL
    type: "GET",
    dataType: "json",
    success: function(data){
      $('#reviews-container').empty();

      data.map((reviewInfo)=>{
        const createdAt = new Date(reviewInfo.createdAt);
        let html = 
        ` <div class="party-host-detail-review-one">
                <div class="party-host-detail-review-content">
                  <text>ë¦¬ë·°</text>
                  <span id="review-content">${reviewInfo.review}</span>
                  <text>í‰ì </text>
                  <span id="review-star">${reviewInfo.rating}</span>
                  <text>ìœ ì €</text>
                  <span id="userId">${reviewInfo.userId}</span>
                  <span id="createdAt">${createdAt.getFullYear()}-${createdAt.getMonth() + 1}-${createdAt.getDate()}</span>
                  <input id="updatereviewform"></input>
                    <button type="button" onclick="updatereview(${reviewInfo.id})"id="review-update">ìˆ˜ì •í•˜ê¸°</button>
                    <button type="button" onclick="deletereview(${reviewInfo.id})"id="review-delete">ì‚­ì œí•˜ê¸°</button>
                    <div class="party-host-detail-review-userid"></div>
                </div>
        </div>
  </div>`
  $('#reviews-container').append(html)
      }
      )
}})
}


function updatereview(reviewId){
  const updatereviewform = $('#updatereviewform').val()
$.ajax({
          type: 'PATCH',
          url: `/review/${reviewId}`,
          data:{
            review: updatereviewform
          },
          success: function(response) {
            // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
            alert("ë¦¬ë·°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
          },
          error: function(error) {
            // ì„œë²„ë¡œë¶€í„° ì˜¤ë¥˜ ì‘ë‹µ ë°›ì€ í›„ ì²˜ë¦¬í•  ì½”ë“œ ì‘ì„±
            alert("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì…ë‹ˆë‹¤.");
          }
        });
        console.log(id);
      }
      

function deletereview(reviewId) {
  
  $.ajax({
    type: 'DELETE',
    url: `/review/${reviewId}`,
    success: function(response) {
      alert("ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
      location.reload();
    },
    error: function(error) {
      alert("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì…ë‹ˆë‹¤.")
    }
  });
}

  
</script>