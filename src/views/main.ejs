<%- include('header.ejs') %>
<main class="partySearch main container">
    <header class="partySearchBar mainHeader">
        <h2 class="a11yHidden">파티 검색</h2>

        <form class="partySearchForm">
            <fieldset>
                <legend class="a11yHidden">파티 검색 폼</legend>

                <input
                    type="text"
                    name="partyWhere"
                    placeholder="어디에서"
                    class="partyWhere"
                    id="partyWhere"
                />

                <div class="partyWhen">
                    <div class="datePickerWrapper"></div>
                </div>

                <input
                    type="text"
                    name="partyName"
                    placeholder="파티 명"
                    class="partyName"
                    id="partyName"
                />

                <button type="submit" class="partySubmitButton" aria-label="파티 검색하기 버튼">
                    <i class="bx bx-search" aria-hidden="true"></i>
                </button>
            </fieldset>
        </form>
    </header>

    <div class="mainSection">
        <ul class="partyList">
            <li class="partyItem">
                <div class="thumbnailWrapper carousel">
                    <a href="" class="partyLink thumbnailLink">
                        <ul class="thumbnailList carouselList">
                            <li class="thumbnailItem carouselItem">
                                <div class="thumbnailRatio">
                                    <img
                                        src="http://placehold.it/320x100?text=sample"
                                        alt=""
                                        class="thumbnailImage"
                                    />
                                </div>
                            </li>
                            <li class="thumbnailItem">
                                <div class="thumbnailRatio">
                                    <img
                                        src="http://placehold.it/320x100?text=sample"
                                        alt=""
                                        class="thumbnailImage"
                                    />
                                </div>
                            </li>
                        </ul>
                    </a>

                    <div class="thumbnailButtonWrapper carouselButtonWrapper">
                        <button
                            type="button"
                            class="thumbnailButton carouselButton prev"
                            aria-label="이전 썸네일 보기"
                        >
                            <i class="bx bx-chevron-left" aria-hidden="true"></i>
                        </button>
                        <button
                            type="button"
                            class="thumbnailButton carouselButton next"
                            aria-label="다음 썸네일 보기"
                        >
                            <i class="bx bx-chevron-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>

                <a href="" class="partyLink">
                    <dl class="partyInfoList">
                        <div class="partyInfoItem partyTitle">
                            <dt class="a11yHidden">제목</dt>
                            <dd>
                                <!-- Backend -->
                                어디까지 작성되는지 봅시다. 한 줄까지만 출력되게 해야지.
                            </dd>
                        </div>
                        <div class="partyInfoItem partyHeadcount">
                            <dt>현재</dt>
                            <dd class="currentCount">
                                <!-- Backend -->
                                3명
                            </dd>
                            <dt>총</dt>
                            <dd class="totalCount">
                                <!-- Backend -->
                                18명
                            </dd>
                        </div>
                        <div class="partyInfoItem partyEtc">
                            <dt class="a11yHidden">지역</dt>
                            <dd class="partyPlace">
                                <!-- Backend -->
                                서울
                            </dd>
                            <dt class="a11yHidden">날짜</dt>
                            <dd class="partyDate">
                                <!-- Backend -->
                                3월 11일
                            </dd>
                        </div>
                    </dl>
                </a>

                <button type="button" class="partyLikeButton" aria-label="좋아요 목록에 추가 버튼">
                    <i class="bx bxs-heart" aria-hidden="true"></i>
                </button>
            </li>
        </ul>
    </div>
</main>

<div>찜목록담기</div>
<button id="like-button${id}" onclick="updateWishList(partyId)">좋아요</button>
<button id="like-button${id}" onclick="check()">check</button>

<script>
    $.ajax({
        type: 'GET',
        url: `/api/party/list`,
        data: {},
        success: function (response) {
            let partyList = response;

            for (let i = 0; i < partyList.length; i++) {
                const partyId = partyList[i]['id'];
                const title = partyList[i]['title'];
                const maxMember = partyList[i]['maxMember'];
                const currMember = partyList[i]['currMember'];
                const thumbnails = partyList[i]['thumbnail'];
                const region = partyList[i]['region'];
                const date = partyList[i]['date'];
                const status = partyList[i]['status'];
                const thumbnailList = partyList[i]['thumbnail'];

                if (!thumbnailList) {
                }

                const thumbnailHtml = `
                    ${thumbnailList
                        .map(
                            ({ thumbnail }) => `
                        <li class="thumbnailItem">
                            <div class="thumbnailRatio">
                                <img
                                    src="${thumbnail}"
                                    alt=""
                                    class="thumbnailImage"
                                />
                            </div>
                        </li>
                    `,
                        )
                        .join('')}
                `;

                const partyItem = `
                    <li class="partyItem">
                        <div class="thumbnailWrapper carousel">
                            <a href="" class="partyLink thumbnailLink">
                                <ul class="thumbnailList carouselList">
                                    ${thumbnailHtml}
                                </ul>
                            </a>

                            <div class="thumbnailButtonWrapper carouselButtonWrapper">
                                <button
                                    type="button"
                                    class="thumbnailButton carouselButton prev"
                                    aria-label="이전 썸네일 보기"
                                >
                                    <i class="bx bx-chevron-left" aria-hidden="true"></i>
                                </button>
                                <button
                                    type="button"
                                    class="thumbnailButton carouselButton next"
                                    aria-label="다음 썸네일 보기"
                                >
                                    <i class="bx bx-chevron-right" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>

                        <a href="" class="partyLink">
                            <dl class="partyInfoList">
                                <div class="partyInfoItem partyTitle">
                                    <dt class="a11yHidden">제목</dt>
                                    <dd>
                                        ${title}
                                    </dd>
                                </div>
                                <div class="partyInfoItem partyHeadcount">
                                    <dt>현재</dt>
                                    <dd class="currentCount">
                                        ${currMember}명
                                    </dd>
                                    <dt>총</dt>
                                    <dd class="totalCount">
                                        ${maxMember}명
                                    </dd>
                                </div>
                                <div class="partyInfoItem partyEtc">
                                    <dt class="a11yHidden">지역</dt>
                                    <dd class="partyPlace">
                                        ${region}
                                    </dd>
                                    <dt class="a11yHidden">날짜</dt>
                                    <dd class="partyDate">
                                        ${date}
                                    </dd>
                                </div>
                            </dl>
                        </a>

                        <button type="button" class="partyLikeButton" aria-label="좋아요 목록에 추가 버튼">
                            <i class="bx bxs-heart" aria-hidden="true"></i>
                        </button>
                    </li>
                `;

                $('.partyList').append(partyItem);
            }
        },
    });

    function check() {
        console.log($('#user').val());
    }
    function updateWishList(partyId) {
        $.ajax({
            type: 'POST',
            url: `/user/wish-list/${partyId}`,
            data: {},
            authorization: `Bearer ${localStorage.getItem('accessToken')}`,
            success: function (response) {
                if (response.updateOrDelete == 0) {
                    $('#like-button${id}').css('color', 'red');
                } else {
                    $('#like-button${id}').css('color', '');
                }
            },
            error: function (error) {
                customAlert(
                    '찜 목록 담기에 실패했습니다. 잠시 후 다시 시도해 주십시오.',
                    function () {
                        window.location.reload();
                    },
                );
            },
        });
    }
</script>
