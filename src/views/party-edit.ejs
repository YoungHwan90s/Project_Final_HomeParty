<%-include('header.ejs') %>

<main class="partyPage partyMake partyEdit main container">
    <form action="" class="partyMakeForm">
        <header class="mainHeader">
            <h2 class="title">
                <!-- Backend -->
                <label for="partyTitle" class="a11yHidden">제목 입력</label>
                <input
                    type="text"
                    placeholder="제목을 입력하세요"
                    id="partyTitle"
                    class="partyTitle"
                />
            </h2>

            <div class="tagListWrapper">
                <ul class="tagList">
                    <li class="tagInputWrapper">
                        <label for="partyTag" class="a11yHidden">태그 입력</label>
                        <input
                            type="text"
                            id="partyTag"
                            class="partyTag"
                            placeholder="Enter키를 이용하여 태그를 입력하세요."
                        />
                    </li>
                </ul>
            </div>

            <dl class="headcountList">
                <div class="headcountItem">
                    <dt>
                        <label for="partyTotalMemeber">총 인원 : </label>
                    </dt>
                    <dd>
                        <input
                            type="number"
                            id="partyTotalMemeber"
                            class="partyTotalMemeber"
                            pattern="[0-9]*"
                            placeholder="0"
                        />
                        명
                    </dd>
                </div>
            </dl>
        </header>

        <div class="mainSection">
            <section class="partyImageSection">
                <h3 class="title">파티 이미지 등록</h3>

                <ul class="partyImageList">
                    <li class="partyImageItem">
                        <label for="partyImage1">
                            이미지 등록
                            <i class="bx bx-plus" aria-hidden="true"></i>
                        </label>
                        <input
                            type="file"
                            class="partyImage"
                            id="partyImage1"
                            accept=".png, .jpg, .jpeg, .svg"
                        />
                        <div class="uploadImageWrapper"></div>
                        <button type="button" class="partyImageReset" aria-label="이미지 삭제">
                            <i class="bx bx-x" aria-hidden="true"></i>
                        </button>
                    </li>
                    <li class="partyImageItem">
                        <label for="partyImage2">
                            이미지 등록
                            <i class="bx bx-plus" aria-hidden="true"></i>
                        </label>
                        <input
                            type="file"
                            class="partyImage"
                            id="partyImage2"
                            accept=".png, .jpg, .jpeg, .svg"
                        />
                        <div class="uploadImageWrapper"></div>
                        <button type="button" class="partyImageReset" aria-label="이미지 삭제">
                            <i class="bx bx-x" aria-hidden="true"></i>
                        </button>
                    </li>
                    <li class="partyImageItem">
                        <label for="partyImage3">
                            이미지 등록
                            <i class="bx bx-plus" aria-hidden="true"></i>
                        </label>
                        <input
                            type="file"
                            class="partyImage"
                            id="partyImage3"
                            accept=".png, .jpg, .jpeg, .svg"
                        />
                        <div class="uploadImageWrapper"></div>
                        <button type="button" class="partyImageReset" aria-label="이미지 삭제">
                            <i class="bx bx-x" aria-hidden="true"></i>
                        </button>
                    </li>
                    <li class="partyImageItem">
                        <label for="partyImage4">
                            이미지 등록
                            <i class="bx bx-plus" aria-hidden="true"></i>
                        </label>
                        <input
                            type="file"
                            class="partyImage"
                            id="partyImage4"
                            accept=".png, .jpg, .jpeg, .svg"
                        />
                        <div class="uploadImageWrapper"></div>
                        <button type="button" class="partyImageReset" aria-label="이미지 삭제">
                            <i class="bx bx-x" aria-hidden="true"></i>
                        </button>
                    </li>
                </ul>
            </section>

            <div class="partyInfoWrapper">
                <section class="IntroduceSection">
                    <h3 class="title">
                        <label for="partyIntroduce">파티 소개</label>
                    </h3>
                    <p>
                        <textarea
                            id="partyIntroduce"
                            class="partyIntroduce"
                            placeholder="파티 소개글 입력"
                        ></textarea>
                    </p>
                </section>

                <section class="calendarSection">
                    <h3 class="title">날짜 선택</h3>
                    <div class="datePickerWrapper">
                        <input type="text" class="datePicker" placeholder="Select date" readonly />
                        <div class="calendar"></div>
                    </div>
                </section>

                <section class="regionSection">
                    <h3 class="title">지역</h3>
                    <div class="addressSearchWrapper">
                        <label for="partyAddressSearch" class="a11yHidden">주소 검색</label>
                        <input
                        type="button"
                        id="partyAddressSearch-1"
                        class="partyAddressSearch"
                        onclick="findAddr()"
                        value="주소 검색"
                        readonly
                        />
                        <input
                            type="text"
                            id="partyAddressSearch-2"
                            class="partyAddressSearch"
                            placeholder="도로명 주소"
                            readonly
                        />

                    </div>
                    <div class="addressDetailWrapper">
                        <label for="partyAddressDetail" class="a11yHidden">상세 주소 입력</label>
                        <input
                            type="text"
                            id="partyAddressDetail"
                            class="partyAddressDetail"
                            placeholder="상세 주소 입력"
                        />
                    </div>

                    <!-- 지도 삽입 -->
                </section>

                <section class="hostSection">
                    <h3 class="a11yHidden">호스트 정보</h3>
                    <div class="hostInfoWrapper">
                        <a href="" class="hostInfoLink">
                            <figure class="hostFigure">
                                <div class="hostImageWrapper">
                                    <img src="http://placehold.it/320x100?text=sample" alt="" />
                                </div>

                                <figcaption>
                                    <h3 class="hostTitle">호스트</h3>
                                    <p class="hostName">
                                        <!-- Backend -->
                                        이정기
                                    </p>
                                    <p class="a11yHidden">호스트 정보 더보기</p>
                                </figcaption>
                            </figure>
                        </a>
                    </div>
                </section>
            </div>
        </div>

        <button type="button" class="partyFormSubmit btn_primary btn_point" onclick="editParty()">등록하기</button>
    </form>
</main>

<script>
    const partyJSON = JSON.parse(sessionStorage.getItem('party'));
    const partyId = window.location.pathname.split('/')[2];

    const { title, content, maxMember, date, thumbnail, tag, address } = partyJSON
    console.log(address)
    console.log(partyJSON)
    // $('#partyTitle').val(title)
    $('#partyIntroduce').val(content)
    $('#partyTotalMemeber').val(maxMember)
    
    // data, address, addThumbnail , removeThumnail, addTagName, removeTagName 더미값 주고 수정해보기

    const partyInfo = {
        title : "오모리",
        content : $('#partyIntroduce').val(),
        maxMember : Number($('#partyTotalMemeber').val()),
        // address: $('#partyAddressSearch-2').val() + ' ' + $('#partyAddressDetail').val(),
        address : address,
        date : date,
        addThumbnail : [],
        removeThumnail : [],
        addTagName : [],
        removeTagName : [],
    }
    console.log(partyInfo)
    function editParty(){
    $.ajax({
        type: 'PATCH',
        url: `/api/party/${partyId}`,
        data: partyInfo,
        headers: {
            authorization: `Bearer ${sessionStorage.getItem('accessToken')}`,
            refreshtoken: `${sessionStorage.getItem('refreshToken')}`,
        },
        success: function (response) {},
    });
}
    //전의 데이터를 다 붙여넣어 주거나, 클라이언트에게 보여준다.

    //추가한 데이터 선우코드 가져와 하나씩 넣는다. (태그, 썹네일)

    //클라이언트가 입력한 데이터를 서버에 보내준다.

    function findAddr() {
        new daum.Postcode({
            oncomplete: function (data) {
                // 사용자 주소를 받아올 변수를 정의한다.
                var addr = '';

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') {
                    // 사용자가 도로명 주소를 선택했을 경우(R)
                    addr = data.roadAddress;
                } else {
                    // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 부모창의 주소칸에 받아온 주소를 넣는다.
                $('#partyAddressSearch-2').val(addr);
            },
        }).open();
    }


</script>
