<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
        />

        <script src="https://kit.fontawesome.com/8b38a77eac.js" crossorigin="anonymous"></script>

        <!-- 아이콘 링크 -->
        <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
        <!-- css -->
        <link rel="stylesheet" href="/css/reset.css" />
        <link rel="stylesheet" href="/library/datePicker/base.css" />
        <link rel="stylesheet" href="/library/datePicker/calendar.css" />
        <link rel="stylesheet" href="/library/datePicker/datePicker.css" />
        <link rel="stylesheet" href="/css/common.css" />
        <link rel="stylesheet" href="/css/modal.css" />
        <link rel="stylesheet" href="/css/main.css" />
        <link rel="stylesheet" href="/css/signup.css" />
        <link rel="stylesheet" href="/css/login.css" />
        <link rel="stylesheet" href="/css/user-menu.css" />
        <link rel="stylesheet" href="/css/profile-upload.css" />
        <link rel="stylesheet" href="/css/user-mypage.css" />
        <link rel="stylesheet" href="/css/user-edit.css" />
        <link rel="stylesheet" href="/css/user-wish-list.css" />
        <link rel="stylesheet" href="/css/partyGrid.css" />
        <link rel="stylesheet" href="/css/party-new.css" />
        <link rel="stylesheet" href="/css/partyPage.css" />
        <link rel="stylesheet" href="/css/admin-page.css" />
        <!-- js -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tiny-slider/2.9.2/min/tiny-slider.js"></script>
        <script src="/library/datePicker/calendar.js"></script>
        <script src="/library/datePicker/datePicker.js"></script>
        <script src="/library/carousel/carousel.js"></script>
        <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
        <script
            type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=70d8ff63eb262881fd470f567a2259ab&libraries=services"
        ></script>
        <link
            href="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.css"
            rel="stylesheet"
        />
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/common.js" defer></script>

        <link rel="shortcut icon" href="/imgs/balloon.gif" />
        <title>모아바 | HOMEPARTY</title>
    </head>
    <body>
        <%-include('alert-modal.ejs') %>

        <header class="main-header" id="main-header"></header>

        <!-- body -->
        <% if (components === 'main') { %> <%-include('main.ejs') %><% } %> 
        <% if (components === 'party') { %> <%-include('party.ejs') %><% } %> 
        <% if (components ==='login') { %> <%-include('auth-login.ejs') %><% } %>
        <% if (components === 'sign-up'){%><%-include('auth-sign-up.ejs') %><% } %>
        <% if (components === 'profile-upload'){%><%-include('auth-profile-upload') %><% } %> 
        <% if (components === 'find-email') {%><%-include('auth-find-email.ejs') %><% } %> 
        <% if (components === 'find-password') {%><%-include('auth-find-password.ejs') %><% } %> 
        <% if (components === 'authentication') {%><%-include('auth-authentication.ejs') %><% } %> 
        <% if (components === 'reset-password') {%><%-include('auth-reset-password.ejs') %><% } %> 
        <% if (components === 'user-menu') {%><%-include('user-menu.ejs') %><% } %>
        <% if (components === 'user-edit') {%><%-include('user-edit.ejs') %><% } %>
        <% if (components === 'user-check') {%><%-include('user-check.ejs') %><% } %>
        <% if (components === 'user-mypage') {%><%-include('user-mypage.ejs') %><% } %>
        <% if (components === 'wish-list') {%><%-include('user-wish-list.ejs') %><% } %>
        <% if (components === 'user-host') {%><%-include('user-host.ejs') %><% } %>
        <% if (components === 'user-party') {%><%-include('user-party.ejs') %><% } %>
        <% if (components === 'user-history') {%><%-include('user-history.ejs') %><% } %>
        <% if (components === 'admin-user') {%><%-include('admin-user.ejs') %><% } %>
        <% if (components === 'admin-party') {%><%-include('admin-party.ejs') %><% } %>
        <% if (components === 'admin-review') {%><%-include('admin-review.ejs') %><% } %>
        <% if (components === 'admin-tag') {%><%-include('admin-tag.ejs') %><% } %>
        <% if (components === 'party-id') {%><%-include('party-detail.ejs') %><% } %>
        <% if (components === 'party-edit') {%><%-include('party-edit.ejs') %><% } %>
        <% if (components === 'party-new') {%><%-include('party-new.ejs') %><% } %> 
        <% if (components === 'party-host-message'){%> <%-include('party-host-message.ejs') %><% } %>
        <% if (components === 'user-detail'){%> <%-include('user-detail.ejs') %><% } %>
        <% if (components === 'party-review'){%> <%-include('party-review.ejs') %><% } %>
        <% if (components === 'no-page'){%> <%-include('404-page.ejs') %><% } %>
        <% if (components === 'kakao') { %>
            <script>
              const accessToken = '<%= accessToken %>';
              const refreshToken = '<%= refreshToken %>';

              sessionStorage.setItem('accessToken', accessToken);
              sessionStorage.setItem('refreshToken', refreshToken);
              window.location.replace('/')
              
            </script>
            <% } %>

        <script>
            $(document).ready(function () {
                getMyInfo(function (userInfo) {
                    if (userInfo) {
                        let html = `<nav class="nav container">
                                    <a href="/" class="nav__logo">
                                        <img src="" alt="" class="nav__logo-img">
                                        모아바
                                    </a>
                                    <div class="nav__menu" id="nav-menu">
                                        <ul class="nav__list">
                                            <li class="nav__item">
                                                <a href="/party" class="nav__link active-link">파티 탐색하기</a>
                                            </li>
                                            <li class="nav__item">
                                                <a href="/party-new" class="nav__link">파티 호스트</a>
                                            </li>
                                            <li class="nav__item">
                                                <a href="/user-menu" class="nav__link">내 계정</a>
                                            </li>
                                            <li class="nav__item">
                                                <a onclick="logout()"" class="nav__link logout">로그아웃</a>
                                            </li>
                                        </ul>
                                        <div class="nav__close" id="nav-close">
                                            <i class='bx bx-x'></i>
                                        </div>
                                    </div>
                                    <div class="nav__toggle" id="nav-toggle">
                                        <i class='bx bx-grid-alt'></i>
                                    </div>
                                </nav>`;
                        $('#main-header').append(html);
                    } else {
                        let html = `<nav class="nav container">
                                    <a href="/" class="nav__logo">
                                        <img src="" alt="" class="nav__logo-img">
                                        모아바
                                    </a>
                                    <div class="nav__menu" id="nav-menu">
                                        <ul class="nav__list">
                                            <li class="nav__item">
                                                <a href="/party" class="nav__link active-link">파티 탐색하기</a>
                                            </li>
                                            <li class="nav__item">
                                                <a href="/party-new" class="nav__link">파티 호스트</a>
                                            </li>
                                            <li class="nav__item">
                                                <a href="/login" class="nav__link">로그인</a>
                                            </li>
                                        </ul>
                                        <div class="nav__close" id="nav-close">
                                            <i class='bx bx-x'></i>
                                        </div>
                                    </div>
                                    <div class="nav__toggle" id="nav-toggle">
                                        <i class='bx bx-grid-alt'></i>
                                    </div>
                                </nav>`;
                        $('#main-header').append(html);
                    }
                    /*=============== SHOW MENU ===============*/
                    const navMenu = document.getElementById('nav-menu'),
                        navToggle = document.getElementById('nav-toggle'),
                        navClose = document.getElementById('nav-close');

                    if (navToggle) {
                        navToggle.addEventListener('click', () => {
                            navMenu.classList.add('show-menu');
                        });
                    }

                    if (navClose) {
                        navClose.addEventListener('click', () => {
                            navMenu.classList.remove('show-menu');
                        });
                        !navMenu.addEventListener('click', () => {
                            navMenu.classList.remove('show-menu');
                        });
                    }

                    /*=============== REMOVE MENU MOBILE ===============*/
                    const navLink = document.querySelectorAll('.nav__link');

                    function linkAction() {
                        const navMenu = document.getElementById('nav-menu');
                        navMenu.classList.remove('show-menu');
                    }

                    navLink.forEach((n) => n.addEventListener('click', linkAction));

                    /*=============== CHANGE BACKGROUND HEADER ===============*/
                    function scrollHeader() {
                        const header = document.getElementById('main-header');

                        if (this.scrollY >= 50) header.classList.add('scroll-header');
                        else header.classList.remove('scroll-header');
                    }
                    window.addEventListener('scroll', scrollHeader);

                    /*=============== SHOW SCROLL UP ===============*/
                    // function scrollUp() {
                    //     const scrollUpButton = document.getElementById('scroll-up');
                    //     //스크롤이 350 뷰포트 높이보다 높을때, a 태그에 show-scroll 클래스를 scroll-top 클래스랑 같이 더함
                    //     if (this.scrollY >= 350) scrollUpButton.classList.add('show-scroll');
                    //     else scrollUpButton.classList.remove('show-scroll');
                    // }
                    // window.addEventListener('scroll', scrollUp);

                    /*=============== SCROLL SECTIONS ACTIVE LINK ===============*/
                    const sections = document.querySelectorAll('section[id]');

                    function scrollActive() {
                        const scrollY = window.pageYOffset;

                        sections.forEach((current) => {
                            const sectionHeight = current.offsetHeight,
                                sectionTop = current.offsetTop - 58,
                                sectionId = current.getAttribute('id');

                            if (scrollY > sectionTop && scrollY <= sectionTop + sectionHeight) {
                                document
                                    .querySelector('.nav__menu a[href*=' + sectionId + ']')
                                    .classList.add('active-link');
                            } else {
                                document
                                    .querySelector('.nav__menu a[href*=' + sectionId + ']')
                                    .classList.remove('active-link');
                            }
                        });
                    }
                    window.addEventListener('scroll', scrollActive);
                });
            });
        </script>
    </body>
</html>
